<div class="top_bar_con">
	<ul>
		<li style="margin-left:8px;"><a href="javascript:;" onclick="showShareDiv()">我要推荐</a></li>
		<li style=""><a href="javascript:;"><!--<img src="__RESOURCE__/images/6-4.png" alt="">--></a></li>
		<{if (!empty($CurrentUser->id))}>
			<li style="margin-left:805px;_margin-left:825px;"><a href="__APP__/user" onmouseover1="$(this).float($('#js-header-replay'))" href="javascript:;"><{$CurrentUser->nickname}></a></li>
			<li style=" margin-top:-10px;">
				<a href="__APP__/user">
					<{if ($CurrentUser->head)}>
						<img width="24" height="24" src="<{$CurrentUser->head|parsePicpath}>" alt="">
					<{else}>
						<img width="24" height="24" src="__RESOURCE__/images/tx.gif" alt="">
					<{/if}>
				</a>
			</li>
		<{else}> 
			<li style="margin-left:850px;_margin-left:860px;">
				<a href="javascript:;" onclick="showLeftLogin()">登录</a>
			</li>
			<li style=""><a href="javascript:;" onclick="showLeftLogin()"><img src="__RESOURCE__/images/6-4.png" alt=""></a></li>
			<li style="margin-left:15px;"><a href="javascript:;" onclick="showRegDiv();" id="js-reg">注册</a></li>
		<{/if}>
		<li style="margin-left:15px;display:none;"><a href="javascript:;">帮助</a></li>
		<li style="display:none;"><a href="javascript:;"><img src="__RESOURCE__/images/6-4.png" alt=""></a></li>
		<{if (!empty($CurrentUser->id))}>
		<li style="margin-left:15px;"><a href="javascript:;" onclick="loginOut();">退出</a></li>
		<{/if}>
	</ul>	
</div>
<{if (empty($CurrentUser->id))}>
<form action="" method="post"  onsubmit="return doLogin(this)">
	<div class="dingwei2" id="js-login-div" style="display:none1">
		<div class="login">
			<div class="login_yi">
				<input name="email" class="name" onmouseout="this.style.borderColor=''" onfocus="if (value =='用户名'){value =''}" value="用户名" onmouseover="this.style.borderColor=''" tabindex="1" onblur="if (value ==''){value='用户名'}" type="text" style="">
			</div>
			<div style="margin-top:15px; _margin-top:-17px;" class="login_yi">
				<input name="password" class="name" onmouseout="this.style.borderColor=''" onfocus="type='password';if (value =='密码'){value =''}" value="密码" onmouseover="this.style.borderColor=''" tabindex="1" onblur="if (value ==''){value='密码';type='text'}" type="text" style="">
			</div>
			<div class="login_er">
				<div class="login_er_left"><input name="" type="checkbox" value="" checked="">记住密码</div>
				<div class="login_er_right"><a href="javascript:;"><input type="image" src="__RESOURCE__/images/61-33.jpg" alt=""></a></div>
			</div>
			<div class="login_san"></div>
			<div class="login_si">使用关联账户登录</div>
			<div class="login_wu">
				<ul>
					<li><a href="javascript:;" onclick="loginTaobao();hideLeftLogin();"><img src="__RESOURCE__/images/29-28-tao.jpg" alt=""></a></li>
					<li><a href="javascript:;" onclick="loginWeibo();hideLeftLogin();"><img src="__RESOURCE__/images/29-28-wei.jpg" alt=""></a></li>
					<li><a href="javascript:;" onclick="loginQQ();hideLeftLogin();"><img src="__RESOURCE__/images/29-28-qq.jpg" alt=""></a></li>
				</ul>
			</div>
		</div>
	</div>
</form>
<{/if}>
<div class="dingwei2">
	<ul class="youhui" id="js-header-share" style="display:none;">
		<li><a href="javascript:;" onclick="showShareDiv()">我要推荐</a></li>
		<!--<li><a href="javascript:;">折扣活动</a></li>-->
	</ul>
	
	<ul class="xiaoxi" id="js-header-replay" style="display:none;">
		<li class="chang">照片<a href="javascript:;">理业主的照片理业主</a>有了新回复</li>
		<li class="duan"><a href="javascript:;">不再提醒</a></li>
		<li class="chang">折扣活动</li>
		<li class="duan"><a href="javascript:;">不再提醒</a></li>
		<li class="chang">照片<a href="javascript:;">理业主助理业主|早起~</a>有了新回复</li>
		<li class="duan"><a href="javascript:;">不再提醒</a></li>
	</ul>
</div>
<script type="text/javascript">

var userCallBak = function(){};

function loginOut() {
	$.ajax({
		url: '__AJAX__/user/loginOut?stmp=' + new Date().toString(),
		dataType: 'json',
		success: function(data) {
			if (data.result) {
				window.location.reload();
			}
		}
	});
}

function showLeftLogin() {
	var obj = $('#js-login-div');
	$.removeCookie('UserInfo');
	var interval = setInterval(function(){
		listenUserInfo(interval);
	},30);
	if (!obj.is(':visible')) {	
		obj.fadeIn('fast', function(){
			$('body').bind('click',function(e) {
				var _this = $(e.target);
				if (!_this.closest('#js-login-div').length) {
					hideLeftLogin();
				}
			});
		});	
	}
}

function hideLeftLogin() {
	var obj = $('#js-login-div');
	obj.fadeOut('fast');
	$('body').unbind('click');
}

function loginTaobao() {
	var url = '<{$connectModel->stepTaobao1}>';  
	window.open(url,'logintaobao','channelmode=yes,width=800,height=500,left=400,top=100');
}

function loginWeibo() {
	var url = '<{$connectModel->stepWeibo1}>';
	window.open(url,'logintaobao','channelmode=yes,width=800,height=500,left=400,top=100');
}

function loginQQ() {
	var url = '<{$connectModel->stepQQ1}>';
	window.open(url,'loginqq','channelmode=yes,width=800,height=500,left=400,top=100');
}

function listenUserInfo(interval) {
	var userInfo = $.cookie('UserInfo');
	if (userInfo) {
		eval('userInfo = ' + userInfo);
	}
	if (typeof(userInfo) == 'object') {
		clearInterval(interval);
		window.location.reload();
	}
}

/*
function preset() {
	$.ajax({
		url: '__APP__/user/preset?stmp=' + new Date().toString(),
		success: function(html) {
			$.mask.close(function(){
				$.mask.show($(html));
			});	
		}
	});
}
*/

function showLoginDiv() {
	$.removeCookie('UserInfo');
	var interval = setInterval(function(){
		listenUserInfo(interval);
	},30);
	$.ajax({
		url: '__APP__/user/userlogin?stmp=' + new Date().toString(),
		success: function(html) {
			$.mask.show($(html));
		}
	});
}

function showRegDiv() {
	$.removeCookie('UserInfo');
	var interval = setInterval(function(){
		listenUserInfo(interval);
	},30);
	$.ajax({
		url: '__APP__/user/userreg?stmp=' + new Date().toString(),
		success: function(html) {
			$.mask.show($(html));
		}
	});
}

function showShareDiv() {
	//如果用户没有登录先登录
	if (!CurrentUserInfo) {
		userCallBak = showShareDiv;
		showLoginDiv();
	}
	else {
		$.ajax({
			url: '__APP__/user/share?stmp=' + new Date().toString(),
			success: function(html) {
				$.mask.show($(html));
			}
		});
	}
}

function doLogin(obj) {
	$(obj).ajaxSubmit({
		type: 'post',
		url: '__AJAX__/user/login?stmp=' + new Date().toString(),
		dataType: 'json',
		success: function(data) {
			if (data.result) {
				CurrentUserInfo = data.result;
				$.mask.close()
				userCallBak();
				showTop();
			}
			else {
				var msg = data.error.message;
				if ($('#js-error').length) {
					$('#js-error').html(msg);
				}
				else {
					alert(msg);
				}
			}
		}
	});
	return false;
}

//注册
function doReg(obj) {
	$(obj).ajaxSubmit({
		dataType: 'json',
		success: function(data) {
			if (data.result) {
				//window.location.href = '__APP__/user/change';
			}
		}
	});
	return false;
}


function rePasswordBlur(obj) {
	var password = $('#js-password').val();
	if (obj.value == '') {
		obj.value='确认密码'
		$(obj).val('');
		$(obj).hide();
		$(obj).prev().show();
	}
	else if (obj.value != password) {
		$('#js-pass-error').html('两次密码输入的不一致').show();
		$(obj).css('border-color','#E872C0');
	}
}

function doPreset() {
	if (!checkNikeNamePreset() | !checkEmailPreset() | !checkPasswordPreset()) {
		return false;
	}
	var formObj = $('#js-preset-form');
	var email = formObj.find('input[name="email"]').val();
	var nikename = formObj.find('input[name="nikename"]').val();
	var password = formObj.find('input[name="password"]').val();
	$.ajax({
		url: '__AJAX__/user/preSet?stmp='+ new Date().toString(),
		data: {email:email,nikename:nikename,password:password},
		dataType: 'json',
		type: 'post',
		success: function(data) {
			if (data.result) {
				window.location.reload();
			}
		}
	});
	return false;
}

function checkNikeNamePreset() {

	var formObj = $('#js-preset-form');
	var nikenameObj = formObj.find('input[name="nikename"]');
	var errObj = nikenameObj.next();
	var nikename = nikenameObj.val();
	if (!nikename) {
		errObj.html('昵称不能为空');
		return false;
	}
	else if (nikename.length > 8) {
		errObj.html('昵称不能超过8个字');
		return false;
	}
	errObj.html('');
	return true;
}

function checkEmailPreset() {
	var formObj = $('#js-preset-form');
	var emailObj = formObj.find('input[name="email"]');
	var errObj = emailObj.next();
	var email = emailObj.val();
	if (!email || email == '登录邮箱') {
		errObj.html('请填写您的登录邮箱');
		return false;
	}
	var url  = '__AJAX__/user/checkuser?stmp'+Math.random();
	var data = {name:email};
	var status = false;
	$.ajax({
		url:url,
		data:data,
		async: false,
		dataType:'json',
		success:function(data){
			if (data.result) {
				status = true;
				errObj.html('<font color="green">用户名可用</font>');
			}
			else {
				errObj.html(data.error.message);
			}
		}
	});
	return status;
}

function checkPasswordPreset() {
	var formObj = $('#js-preset-form');
	var passwordObj = formObj.find('input[name="password"]');
	var errObj = passwordObj.next();
	var password = passwordObj.val();
	if (password == '密码') {
		password = '';
	}
	if (!password || password.length < 6) {
		errObj.html('密码不能小于6位');
		return false;
	}
	if (password.length > 32) {
		errObj.html('密码不能大于32位');
		return false;
	}
	errObj.html('');
	return true;
}

function checkuser() {
	obj = $('#js-user-email');
	var name = obj.val();
	if (!name || name == '登录邮箱') {
		$('#js-email-error').html('请填写您的登录邮箱').show();
		obj.css('border-color','#E872C0');
		if (name =='') {
			obj.val('登录邮箱');
		}
		return false;
	}
	
	var data = {name:name};
	var url  = '__AJAX__/user/checkuser?stmp'+Math.random();
	$.ajax({
		type:'get',
		url:url,
		data:data,
		dataType:'json',
		success:function(data){
			if (data.result) {
				$('#js-email-error').html('<font color="green">用户名可用</font>').show();
				$(obj).css('border-color','#cdcdcd');
			}
			else {
				$('#js-email-error').html(data.error.message).show();
				$(obj).css('border-color','#E872C0');
			}
		}
	});
}

function checkverify(value) {
	if (value ==''){value='验证码'}
	var data = {verify:value};
	var url  = '__AJAX__/user/checkverify?stmp'+Math.random();
	$.ajax({
		type:'get',
		url:url,
		data:data,
		dataType:'json',
		success:function(data){
			if (data.result) {
				$('.kuang3').css('border-color','#cdcdcd');
				$('#verify').html('');
			}
			else {
				$('#verify').html('<font color="#E872C0">'+data.error.message+'</font>');
				$('.kuang3').css('border-color','#E872C0');
			}
		}
	});
}
//CharMode函数 
//测试某个字符是属于哪一类. 
function CharMode(iN) {
	if (iN >= 48 && iN <= 57) //数字 
		return 1;
	if (iN >= 65 && iN <= 90) //大写字母 
		return 2;
	if (iN >= 97 && iN <= 122) //小写 
		return 4;
	else
		return 8; //特殊字符 
}
//bitTotal函数 
//计算出当前密码当中一共有多少种模式 
function bitTotal(num) {
	modes = 0;
	for (i = 0; i < 4; i++) {
		if (num & 1) modes++;
		num >>>= 1;
	}
	return modes;
}
//checkStrong函数 
//返回密码的强度级别 
function checkStrong(sPW) {
	if (sPW.length <= 4)
		return 0; //密码太短 
	Modes = 0;
	for (i = 0; i < sPW.length; i++) {
		//测试每一个字符的类别并统计一共有多少种模式. 
		Modes |= CharMode(sPW.charCodeAt(i));
	}
	return bitTotal(Modes);
}
//pwStrength函数 
//当用户放开键盘或密码输入框失去焦点时，根据不同的级别显示不同的颜色 
function pwStrength(pwd, type) {
	if (pwd == null || pwd == '') {
		$(".right2_yi_zuo").html('<img src="__RESOURCE__/images/ruo1.jpg">');
		$(".right2_yi_zhong").html('<img src="__RESOURCE__/images/zhong.jpg">');
		$(".right2_yi_you").html('<img src="__RESOURCE__/images/qiang.jpg">');
		$('#js-pass-error').html('请填写密码').show();
		$('#js-password').hide().prev().show();
		$('#js-password').css('border-color','#E872C0');
	}
	else if (type && type == 'onblur' && pwd.length < 6) {
		$('#js-pass-error').html('密码不能低于6位').show();
		$('#password').css('border-color','#E872C0');
	}
	else if(pwd.length > 32) {
		$('#js-pass-error').html('密码不能超过32位').show();
		$('#password').css('border-color','#E872C0');
	}
	else {
		$('#js-pass-error').html('').hide();	
		$('#js-password').css('border-color','#cdcdcd');
		S_level = checkStrong(pwd);
		switch (S_level) {
			case 0:
				$(".right2_yi_zuo").html('<img src="__RESOURCE__/images/ruo1.jpg">');
				$(".right2_yi_zhong").html('<img src="__RESOURCE__/images/zhong.jpg">');
				$(".right2_yi_you").html('<img src="__RESOURCE__/images/qiang.jpg">');
			case 1:
				$(".right2_yi_zuo").html('<img src="__RESOURCE__/images/ruo1.jpg">');
				$(".right2_yi_zhong").html('<img src="__RESOURCE__/images/zhong.jpg">');
				$(".right2_yi_you").html('<img src="__RESOURCE__/images/qiang.jpg">');
				break;
			case 2:		 
			   $(".right2_yi_zuo").html('<img src="__RESOURCE__/images/ruo.gif">');
			   $(".right2_yi_you").html('<img src="__RESOURCE__/images/qiang.jpg">');
			   $(".right2_yi_zhong").html('<img src="__RESOURCE__/images/zhong1.gif">');
				break;
			default:
				$(".right2_yi_zuo").html('<img src="__RESOURCE__/images/ruo.gif">');
				$(".right2_yi_zhong").html('<img src="__RESOURCE__/images/zhong.jpg">');
				$(".right2_yi_you").html('<img src="__RESOURCE__/images/qiang1.gif">');
		}
	}
} 

//获取用户消息
$.ajax({
	url: '__AJAX__/user/getReply?stmp=' + new Date().toString(),
	dataType: 'json',
	success: function(data) {
		
	}
});

</script>